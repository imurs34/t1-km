{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/jeongyeon/Desktop/lecture_segmentation/web_dev/code/t1_km/components/Content.jsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport shortid from \"shortid\";\nimport toStyle from \"css-to-style\";\nimport useFitText from \"use-fit-text\";\nimport React, { useCallback, useEffect, useReducer, useRef } from \"react\";\nimport styled, { css } from \"styled-components\";\nimport { Rnd } from \"react-rnd\";\nimport { useAtom } from \"jotai\";\nimport { useState } from \"react\";\nimport InnerVideo from \"./InnerVideo\";\nimport RndVideo from \"./RndVideo\";\nimport Text from \"./Text\";\nimport Image, { FixedImage } from \"./Image\";\nimport { activityAtom, lockAtom, withFrameAtom } from \"../atom\";\nconst ChunkedData = /*#__PURE__*/React.memo(({\n  data,\n  addFixedData,\n  index,\n  sourcePath,\n  isFull\n}) => {\n  const sortedData = _.orderBy(data, \"order\");\n\n  return /*#__PURE__*/_jsxDEV(InnerColumn, {\n    children: sortedData.map(obj => {\n      if (obj.label === \"text_box\") {\n        return /*#__PURE__*/_jsxDEV(Text, {\n          obj: obj,\n          addFixedData: addFixedData,\n          isFull: isFull\n        }, shortid.generate(), false, {\n          fileName: _jsxFileName,\n          lineNumber: 22,\n          columnNumber: 28\n        }, this);\n      } else if (obj.label === \"video\") {\n        return /*#__PURE__*/_jsxDEV(InnerVideo, {\n          url: `${sourcePath}${obj.path}`,\n          addFixedData: addFixedData,\n          startTime: obj.start_time,\n          endTime: obj.end_time,\n          index: index,\n          index: index\n        }, shortid.generate(), false, {\n          fileName: _jsxFileName,\n          lineNumber: 25,\n          columnNumber: 25\n        }, this);\n      } else {\n        return /*#__PURE__*/_jsxDEV(Image, {\n          url: `${sourcePath}${obj.path}`,\n          addFixedData: addFixedData\n        }, shortid.generate(), false, {\n          fileName: _jsxFileName,\n          lineNumber: 36,\n          columnNumber: 28\n        }, this);\n      }\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 19,\n    columnNumber: 9\n  }, this);\n});\nconst PositionedData = /*#__PURE__*/React.memo(({\n  data,\n  addFixedData,\n  index,\n  sourcePath,\n  isFull,\n  template\n}) => {\n  const [x, y, width, height] = data.box_info_original;\n  const startXRatio = x / template.width * 100;\n  const startYRatio = y / template.height * 100;\n  const widthRatio = width / template.width * 100;\n  const heightRatio = height / template.height * 100;\n\n  if (data.label === \"text_box\") {\n    return /*#__PURE__*/_jsxDEV(PositionedDataContainer, {\n      x: startXRatio,\n      y: startYRatio,\n      width: widthRatio,\n      height: heightRatio,\n      children: /*#__PURE__*/_jsxDEV(Text, {\n        obj: data,\n        addFixedData: addFixedData,\n        isFull: isFull\n      }, shortid.generate(), false, {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 13\n    }, this);\n  }\n\n  if (data.label === \"video\") {\n    return /*#__PURE__*/_jsxDEV(PositionedDataContainer, {\n      x: startXRatio,\n      y: startYRatio,\n      width: widthRatio,\n      height: heightRatio,\n      children: /*#__PURE__*/_jsxDEV(InnerVideo, {\n        url: `${sourcePath}${obj.path}`,\n        addFixedData: addFixedData,\n        startTime: obj.start_time,\n        endTime: obj.end_time,\n        index: index,\n        index: index\n      }, shortid.generate(), false, {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 13\n    }, this);\n  }\n\n  if (data.label === \"title\") {\n    return /*#__PURE__*/_jsxDEV(PositionedDataContainer, {\n      x: startXRatio,\n      y: startYRatio,\n      width: widthRatio,\n      height: heightRatio,\n      children: /*#__PURE__*/_jsxDEV(FixedImage, {\n        url: `${sourcePath}${data.path}`\n      }, shortid.generate(), false, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 13\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(PositionedDataContainer, {\n    x: startXRatio,\n    y: startYRatio,\n    width: widthRatio,\n    height: heightRatio,\n    children: /*#__PURE__*/_jsxDEV(Image, {\n      url: `${sourcePath}${data.path}`,\n      addFixedData: addFixedData\n    }, shortid.generate(), false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 9\n  }, this);\n});\nconst PositionedDataContainer = styled.div.withConfig({\n  displayName: \"Content__PositionedDataContainer\",\n  componentId: \"sc-164klk-0\"\n})([\"width:\", \"%;height:\", \"%;top:\", \"%;left:\", \"%;position:absolute;display:flex;\"], props => props.width, props => props.height, props => props.y, props => props.x);\n\nconst checkOnlyData = (prev, next) => {\n  return prev.data === next.data && prev.isFull === next.isFull;\n};\n\nconst MemoedChunkedData = /*#__PURE__*/React.memo(ChunkedData, checkOnlyData);\nconst MemoedPositionedData = /*#__PURE__*/React.memo(PositionedData, checkOnlyData);\n\nconst FixedElement = ({\n  data,\n  clicked,\n  keyValue,\n  isactive\n}) => {\n  const {\n    0: state,\n    1: setState\n  } = useState({\n    x: data.x,\n    y: data.y,\n    width: data.width,\n    height: data.height\n  });\n  const {\n    0: visiable,\n    1: setVisiable\n  } = useState(false);\n  const {\n    fontSize,\n    ref,\n    onStart,\n    onFinish\n  } = useFitText({\n    maxFontSize: 1000,\n    resolution: 1,\n    minFontSize: 1,\n    onStart: () => {\n      setVisiable(false);\n    },\n    onFinish: () => {\n      setVisiable(true);\n    }\n  });\n  const [lock] = useAtom(lockAtom);\n\n  const run = () => {\n    clicked(keyValue);\n  };\n\n  const clear = () => {\n    clicked(\"\");\n  };\n\n  if (data.label === \"IMG\") {\n    return /*#__PURE__*/_jsxDEV(CustomRnd, {\n      enableResizing: !lock,\n      disableDragging: lock,\n      onDragStart: run,\n      onResizeStart: run,\n      bounds: \".frame\",\n      isactive: isactive,\n      size: {\n        width: state.width,\n        height: state.height,\n        background: \"red\"\n      },\n      position: {\n        x: state.x,\n        y: state.y\n      },\n      onDragStop: (e, d) => {\n        setState(_objectSpread(_objectSpread({}, state), {}, {\n          x: d.x,\n          y: d.y\n        }));\n      },\n      style: data.style,\n      onResizeStop: (e, direction, ref, delta, position) => {\n        setState(_objectSpread({\n          width: ref.style.width,\n          height: ref.style.height\n        }, position));\n      },\n      children: [/*#__PURE__*/_jsxDEV(RndImg, {\n        src: data.src,\n        draggable: \"false\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 17\n      }, this), isactive && /*#__PURE__*/_jsxDEV(Clear, {\n        onClick: clear,\n        children: \"confirm\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 30\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 13\n    }, this);\n  }\n\n  if (data.label === \"VIDEO\") {\n    return /*#__PURE__*/_jsxDEV(CustomRnd, {\n      enableResizing: !lock,\n      disableDragging: lock,\n      onDragStart: run,\n      onResizeStart: run,\n      bounds: \".frame\",\n      isactive: isactive,\n      size: {\n        width: state.width,\n        height: state.height,\n        background: \"red\"\n      },\n      position: {\n        x: state.x,\n        y: state.y\n      },\n      onDragStop: (e, d) => {\n        setState(_objectSpread(_objectSpread({}, state), {}, {\n          x: d.x,\n          y: d.y\n        }));\n      },\n      style: data.style,\n      onResizeStop: (e, direction, ref, delta, position) => {\n        setState(_objectSpread({\n          width: ref.style.width,\n          height: ref.style.height\n        }, position));\n      },\n      children: [/*#__PURE__*/_jsxDEV(RndVideo, {\n        url: data.src,\n        startTime: data.startTime\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 17\n      }, this), isactive && /*#__PURE__*/_jsxDEV(Clear, {\n        onClick: clear,\n        children: \"confirm\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 30\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 13\n    }, this);\n  }\n\n  if (data.label === \"P\") {\n    return /*#__PURE__*/_jsxDEV(CustomRnd, {\n      enableResizing: !lock,\n      disableDragging: lock,\n      onDragStart: run,\n      onResizeStart: run,\n      bounds: \".frame\",\n      isactive: isactive,\n      size: {\n        width: state.width,\n        height: state.height,\n        background: \"red\"\n      },\n      position: {\n        x: state.x,\n        y: state.y\n      },\n      onDragStop: (e, d) => {\n        setState(_objectSpread(_objectSpread({}, state), {}, {\n          x: d.x,\n          y: d.y\n        }));\n      },\n      style: data.style,\n      onResizeStop: (e, direction, ref, delta, position) => {\n        setState(_objectSpread({\n          width: ref.style.width,\n          height: ref.style.height\n        }, position));\n      },\n      children: [/*#__PURE__*/_jsxDEV(PCon, {\n        ref: ref,\n        style: {\n          fontSize\n        },\n        lineHeight: data.style.lineHeight,\n        font: data.style[\"font-family\"],\n        weight: data.style[\"font-weight\"],\n        visiable: visiable,\n        children: data.text\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 17\n      }, this), isactive && /*#__PURE__*/_jsxDEV(Clear, {\n        onClick: clear,\n        children: \"confirm\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 30\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 13\n    }, this);\n  }\n};\n\nconst Clear = styled.button.withConfig({\n  displayName: \"Content__Clear\",\n  componentId: \"sc-164klk-1\"\n})([\"position:absolute;right:0;top:-20px;@media only screen and (max-width:900px){display:none;}\"]);\n\nfunction Content({\n  data,\n  index,\n  sourcePath,\n  frameInfo,\n  isFull,\n  template\n}) {\n  const chunkedData = _.groupBy(data.learning_material, \"in_column\");\n\n  const [activity] = useAtom(activityAtom);\n  const [withFrame] = useAtom(withFrameAtom);\n  const {\n    0: isactive,\n    1: setIsActive\n  } = useState(false);\n  useEffect(() => {\n    setIsActive(activity.slide === index);\n  }, [activity.slide]);\n  const {\n    0: state\n  } = useState({\n    chunkedData,\n    column: data.column\n  });\n  const {\n    0: fixedData,\n    1: setFixedData\n  } = useState({});\n  const addFixedData = useCallback(data => {\n    const newKey = shortid.generate();\n    setFixedData(prevState => {\n      setNodeEl(newKey);\n      return _objectSpread(_objectSpread({}, prevState), {}, {\n        [newKey]: _objectSpread({}, data)\n      });\n    });\n  });\n\n  const titleObj = _.find(data.learning_material, o => o.label === \"title\");\n\n  const {\n    0: nodeEl,\n    1: setNodeEl\n  } = useState();\n\n  const clicked = key => {\n    setNodeEl(key);\n  };\n\n  const frameRatio = template.width / template.height;\n\n  if (data.column === 0) {\n    return /*#__PURE__*/_jsxDEV(Container, {\n      isactive: isactive,\n      bg: `${sourcePath}${data.bg_image}`,\n      children: [/*#__PURE__*/_jsxDEV(Inner, {\n        children: [frameInfo.topBg && /*#__PURE__*/_jsxDEV(Frame, {\n          src: frameInfo.sourcePath + frameInfo.topBg,\n          height: frameInfo.topHeight,\n          isactive: withFrame\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 41\n        }, this), /*#__PURE__*/_jsxDEV(PositionedContainer, {\n          children: /*#__PURE__*/_jsxDEV(PositionedCanvas, {\n            ratio: frameRatio,\n            children: _.chain(state.chunkedData).values().flatten().value().map((obj, index) => {\n              return /*#__PURE__*/_jsxDEV(MemoedPositionedData, {\n                data: obj,\n                template: template,\n                addFixedData: addFixedData,\n                index: index,\n                sourcePath: sourcePath,\n                isFull: isFull\n              }, index, false, {\n                fileName: _jsxFileName,\n                lineNumber: 251,\n                columnNumber: 44\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Frame, {\n          src: frameInfo.sourcePath + frameInfo.bottomBg,\n          height: frameInfo.bottomHeight,\n          isactive: withFrame\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 17\n      }, this), Object.entries(fixedData).map(value => /*#__PURE__*/_jsxDEV(FixedElement, {\n        data: value[1],\n        clicked: clicked,\n        isactive: nodeEl === value[0],\n        keyValue: value[0]\n      }, value[0], false, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 21\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 13\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Container, {\n    isactive: isactive,\n    bg: `${sourcePath}${data.bg_image}`,\n    children: [/*#__PURE__*/_jsxDEV(Inner, {\n      children: [frameInfo.topBG && /*#__PURE__*/_jsxDEV(Frame, {\n        src: frameInfo.sourcePath + frameInfo.topBg,\n        height: frameInfo.topHeight,\n        isactive: withFrame\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 37\n      }, this), titleObj && /*#__PURE__*/_jsxDEV(TitleContainer, {\n        children: /*#__PURE__*/_jsxDEV(TitleImg, {\n          src: `${sourcePath}${titleObj.path}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(ColumnContainer, {\n        children: _.times(state.column, i => {\n          return /*#__PURE__*/_jsxDEV(MemoedChunkedData, {\n            data: state.chunkedData[i + 1],\n            addFixedData: addFixedData,\n            index: index,\n            sourcePath: sourcePath,\n            isFull: isFull\n          }, i, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 32\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 17\n      }, this), frameInfo.bottomBg && /*#__PURE__*/_jsxDEV(Frame, {\n        src: frameInfo.sourcePath + frameInfo.bottomBg,\n        height: frameInfo.bottomHeight,\n        isactive: withFrame\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 40\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 13\n    }, this), Object.entries(fixedData).map(value => /*#__PURE__*/_jsxDEV(FixedElement, {\n      data: value[1],\n      clicked: clicked,\n      isactive: nodeEl === value[0],\n      keyValue: value[0]\n    }, value[0], false, {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 17\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 264,\n    columnNumber: 9\n  }, this);\n}\n\nconst Frame = styled.img.withConfig({\n  displayName: \"Content__Frame\",\n  componentId: \"sc-164klk-2\"\n})([\"flex-basis:\", \"%;object-fit:fill;display:\", \";\"], props => props.height, props => props.isactive ? \"block\" : \"none\");\nconst Inner = styled.div.withConfig({\n  displayName: \"Content__Inner\",\n  componentId: \"sc-164klk-3\"\n})([\"display:flex;flex-direction:column;flex:1;align-items:stretch;max-height:85vh;\"]);\nconst PositionedCanvas = styled.div.withConfig({\n  displayName: \"Content__PositionedCanvas\",\n  componentId: \"sc-164klk-4\"\n})([\"--current-height:calc(100vh - 50px);width:calc(var(--current-height) * \", \");height:100%;margin:0 auto;position:relative;\"], props => props.ratio);\nconst PositionedContainer = styled.div.withConfig({\n  displayName: \"Content__PositionedContainer\",\n  componentId: \"sc-164klk-5\"\n})([\"display:flex;flex:1;\"]);\nconst ColumnContainer = styled.div.withConfig({\n  displayName: \"Content__ColumnContainer\",\n  componentId: \"sc-164klk-6\"\n})([\"flex:1;display:flex;\"]);\nconst TitleImg = styled.img.withConfig({\n  displayName: \"Content__TitleImg\",\n  componentId: \"sc-164klk-7\"\n})([\"width:100%;height:100%;object-fit:contain;object-position:left top;\"]);\nconst TitleContainer = styled.div.withConfig({\n  displayName: \"Content__TitleContainer\",\n  componentId: \"sc-164klk-8\"\n})([\"height:10%;width:100%;padding:0 20px 0 !important;@media only screen and (max-width:900px){height:20px;}\"]);\nconst PCon = styled.div.withConfig({\n  displayName: \"Content__PCon\",\n  componentId: \"sc-164klk-9\"\n})([\"width:100%;height:100%;line-height:\", \";font-weight:\", \";letter-spacing:0;white-space:pre-wrap;font-family:\", \";visibility:\", \";box-sizing:border-box;padding:0.5px;\"], props => `${props.lineHeight}%`, props => props.weight, props => props.font, props => props.visiable ? \"visible\" : \"hidden\");\nconst CustomRnd = styled(Rnd).withConfig({\n  displayName: \"Content__CustomRnd\",\n  componentId: \"sc-164klk-10\"\n})([\"box-sizing:border-box;\", \";\"], props => props.isactive && css([\"z-index:10;outline:2px solid #a9ceeb;box-shadow:0px 2px 5px 5px #a9ceeb;\"]));\nconst RndImg = styled.img.withConfig({\n  displayName: \"Content__RndImg\",\n  componentId: \"sc-164klk-11\"\n})([\"width:inherit;height:inherit;\"]);\nconst InnerColumn = styled.div.withConfig({\n  displayName: \"Content__InnerColumn\",\n  componentId: \"sc-164klk-12\"\n})([\"flex:1;display:flex;flex-direction:column;padding:10px;\"]);\nconst Container = styled.div.withConfig({\n  displayName: \"Content__Container\",\n  componentId: \"sc-164klk-13\"\n})([\"padding-top:16px;display:\", \";background-image:\", \";background-repeat:no-repeat;background-size:100% 100%;flex:1;align-items:stretch;\"], props => props.isactive ? \"flex\" : \"none\", props => props.bg ? `url(${props.bg})` : \"none\");\nexport default /*#__PURE__*/React.memo(Content);","map":{"version":3,"sources":["/Users/jeongyeon/Desktop/lecture_segmentation/web_dev/code/t1_km/components/Content.jsx"],"names":["shortid","toStyle","useFitText","React","useCallback","useEffect","useReducer","useRef","styled","css","Rnd","useAtom","useState","InnerVideo","RndVideo","Text","Image","FixedImage","activityAtom","lockAtom","withFrameAtom","ChunkedData","memo","data","addFixedData","index","sourcePath","isFull","sortedData","_","orderBy","map","obj","label","generate","path","start_time","end_time","PositionedData","template","x","y","width","height","box_info_original","startXRatio","startYRatio","widthRatio","heightRatio","PositionedDataContainer","div","props","checkOnlyData","prev","next","MemoedChunkedData","MemoedPositionedData","FixedElement","clicked","keyValue","isactive","state","setState","visiable","setVisiable","fontSize","ref","onStart","onFinish","maxFontSize","resolution","minFontSize","lock","run","clear","background","e","d","style","direction","delta","position","src","startTime","lineHeight","text","Clear","button","Content","frameInfo","chunkedData","groupBy","learning_material","activity","withFrame","setIsActive","slide","column","fixedData","setFixedData","newKey","prevState","setNodeEl","titleObj","find","o","nodeEl","key","frameRatio","bg_image","topBg","topHeight","chain","values","flatten","value","bottomBg","bottomHeight","Object","entries","topBG","times","i","Frame","img","Inner","PositionedCanvas","ratio","PositionedContainer","ColumnContainer","TitleImg","TitleContainer","PCon","weight","font","CustomRnd","RndImg","InnerColumn","Container","bg"],"mappings":";;;;;;;;;AAAA,OAAOA,OAAP,MAAoB,SAApB;AACA,OAAOC,OAAP,MAAoB,cAApB;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,OAAOC,KAAP,IAAgBC,WAAhB,EAA6BC,SAA7B,EAAwCC,UAAxC,EAAoDC,MAApD,QAAkE,OAAlE;AACA,OAAOC,MAAP,IAAiBC,GAAjB,QAA4B,mBAA5B;AACA,SAASC,GAAT,QAAoB,WAApB;AACA,SAASC,OAAT,QAAwB,OAAxB;AACA,SAASC,QAAT,QAAyB,OAAzB;AAEA,OAAOC,UAAP,MAAuB,cAAvB;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,OAAOC,IAAP,MAAiB,QAAjB;AACA,OAAOC,KAAP,IAAgBC,UAAhB,QAAkC,SAAlC;AACA,SAASC,YAAT,EAAuBC,QAAvB,EAAiCC,aAAjC,QAAsD,SAAtD;AAEA,MAAMC,WAAW,gBAAGlB,KAAK,CAACmB,IAAN,CAAW,CAAC;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,YAAR;AAAsBC,EAAAA,KAAtB;AAA6BC,EAAAA,UAA7B;AAAyCC,EAAAA;AAAzC,CAAD,KAAuD;AAClF,QAAMC,UAAU,GAAGC,CAAC,CAACC,OAAF,CAAUP,IAAV,EAAgB,OAAhB,CAAnB;;AACA,sBACI,QAAC,WAAD;AAAA,cACKK,UAAU,CAACG,GAAX,CAAgBC,GAAD,IAAS;AACrB,UAAIA,GAAG,CAACC,KAAJ,KAAc,UAAlB,EAA8B;AAC1B,4BAAO,QAAC,IAAD;AAAM,UAAA,GAAG,EAAED,GAAX;AAAgB,UAAA,YAAY,EAAER,YAA9B;AAAqE,UAAA,MAAM,EAAEG;AAA7E,WAAiD3B,OAAO,CAACkC,QAAR,EAAjD;AAAA;AAAA;AAAA;AAAA,gBAAP;AACH,OAFD,MAEO,IAAIF,GAAG,CAACC,KAAJ,KAAc,OAAlB,EAA2B;AAC9B,4BACI,QAAC,UAAD;AACI,UAAA,GAAG,EAAG,GAAEP,UAAW,GAAEM,GAAG,CAACG,IAAK,EADlC;AAEI,UAAA,YAAY,EAAEX,YAFlB;AAGI,UAAA,SAAS,EAAEQ,GAAG,CAACI,UAHnB;AAII,UAAA,OAAO,EAAEJ,GAAG,CAACK,QAJjB;AAKI,UAAA,KAAK,EAAEZ,KALX;AAOI,UAAA,KAAK,EAAEA;AAPX,WAMSzB,OAAO,CAACkC,QAAR,EANT;AAAA;AAAA;AAAA;AAAA,gBADJ;AAWH,OAZM,MAYA;AACH,4BAAO,QAAC,KAAD;AAAO,UAAA,GAAG,EAAG,GAAER,UAAW,GAAEM,GAAG,CAACG,IAAK,EAArC;AAAwC,UAAA,YAAY,EAAEX;AAAtD,WAAyExB,OAAO,CAACkC,QAAR,EAAzE;AAAA;AAAA;AAAA;AAAA,gBAAP;AACH;AACJ,KAlBA;AADL;AAAA;AAAA;AAAA;AAAA,UADJ;AAuBH,CAzBmB,CAApB;AA0BA,MAAMI,cAAc,gBAAGnC,KAAK,CAACmB,IAAN,CAAW,CAAC;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,YAAR;AAAsBC,EAAAA,KAAtB;AAA6BC,EAAAA,UAA7B;AAAyCC,EAAAA,MAAzC;AAAiDY,EAAAA;AAAjD,CAAD,KAAiE;AAC/F,QAAM,CAACC,CAAD,EAAIC,CAAJ,EAAOC,KAAP,EAAcC,MAAd,IAAwBpB,IAAI,CAACqB,iBAAnC;AACA,QAAMC,WAAW,GAAIL,CAAC,GAAGD,QAAQ,CAACG,KAAd,GAAuB,GAA3C;AACA,QAAMI,WAAW,GAAIL,CAAC,GAAGF,QAAQ,CAACI,MAAd,GAAwB,GAA5C;AACA,QAAMI,UAAU,GAAIL,KAAK,GAAGH,QAAQ,CAACG,KAAlB,GAA2B,GAA9C;AACA,QAAMM,WAAW,GAAIL,MAAM,GAAGJ,QAAQ,CAACI,MAAnB,GAA6B,GAAjD;;AACA,MAAIpB,IAAI,CAACU,KAAL,KAAe,UAAnB,EAA+B;AAC3B,wBACI,QAAC,uBAAD;AAAyB,MAAA,CAAC,EAAEY,WAA5B;AAAyC,MAAA,CAAC,EAAEC,WAA5C;AAAyD,MAAA,KAAK,EAAEC,UAAhE;AAA4E,MAAA,MAAM,EAAEC,WAApF;AAAA,6BACI,QAAC,IAAD;AAAM,QAAA,GAAG,EAAEzB,IAAX;AAAiB,QAAA,YAAY,EAAEC,YAA/B;AAAsE,QAAA,MAAM,EAAEG;AAA9E,SAAkD3B,OAAO,CAACkC,QAAR,EAAlD;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,YADJ;AAKH;;AACD,MAAIX,IAAI,CAACU,KAAL,KAAe,OAAnB,EAA4B;AACxB,wBACI,QAAC,uBAAD;AAAyB,MAAA,CAAC,EAAEY,WAA5B;AAAyC,MAAA,CAAC,EAAEC,WAA5C;AAAyD,MAAA,KAAK,EAAEC,UAAhE;AAA4E,MAAA,MAAM,EAAEC,WAApF;AAAA,6BACI,QAAC,UAAD;AAAY,QAAA,GAAG,EAAG,GAAEtB,UAAW,GAAEM,GAAG,CAACG,IAAK,EAA1C;AAA6C,QAAA,YAAY,EAAEX,YAA3D;AAAyE,QAAA,SAAS,EAAEQ,GAAG,CAACI,UAAxF;AAAoG,QAAA,OAAO,EAAEJ,GAAG,CAACK,QAAjH;AAA2H,QAAA,KAAK,EAAEZ,KAAlI;AAAkK,QAAA,KAAK,EAAEA;AAAzK,SAA8IzB,OAAO,CAACkC,QAAR,EAA9I;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,YADJ;AAKH;;AACD,MAAIX,IAAI,CAACU,KAAL,KAAe,OAAnB,EAA4B;AACxB,wBACI,QAAC,uBAAD;AAAyB,MAAA,CAAC,EAAEY,WAA5B;AAAyC,MAAA,CAAC,EAAEC,WAA5C;AAAyD,MAAA,KAAK,EAAEC,UAAhE;AAA4E,MAAA,MAAM,EAAEC,WAApF;AAAA,6BACI,QAAC,UAAD;AAAY,QAAA,GAAG,EAAG,GAAEtB,UAAW,GAAEH,IAAI,CAACY,IAAK;AAA3C,SAAmDnC,OAAO,CAACkC,QAAR,EAAnD;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,YADJ;AAKH;;AAED,sBACI,QAAC,uBAAD;AAAyB,IAAA,CAAC,EAAEW,WAA5B;AAAyC,IAAA,CAAC,EAAEC,WAA5C;AAAyD,IAAA,KAAK,EAAEC,UAAhE;AAA4E,IAAA,MAAM,EAAEC,WAApF;AAAA,2BACI,QAAC,KAAD;AAAO,MAAA,GAAG,EAAG,GAAEtB,UAAW,GAAEH,IAAI,CAACY,IAAK,EAAtC;AAAyC,MAAA,YAAY,EAAEX;AAAvD,OAA0ExB,OAAO,CAACkC,QAAR,EAA1E;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,UADJ;AAKH,CAjCsB,CAAvB;AAkCA,MAAMe,uBAAuB,GAAGzC,MAAM,CAAC0C,GAAV;AAAA;AAAA;AAAA,sFACfC,KAAD,IAAWA,KAAK,CAACT,KADD,EAEdS,KAAD,IAAWA,KAAK,CAACR,MAFF,EAGjBQ,KAAD,IAAWA,KAAK,CAACV,CAHC,EAIhBU,KAAD,IAAWA,KAAK,CAACX,CAJA,CAA7B;;AASA,MAAMY,aAAa,GAAG,CAACC,IAAD,EAAOC,IAAP,KAAgB;AAClC,SAAOD,IAAI,CAAC9B,IAAL,KAAc+B,IAAI,CAAC/B,IAAnB,IAA2B8B,IAAI,CAAC1B,MAAL,KAAgB2B,IAAI,CAAC3B,MAAvD;AACH,CAFD;;AAIA,MAAM4B,iBAAiB,gBAAGpD,KAAK,CAACmB,IAAN,CAAWD,WAAX,EAAwB+B,aAAxB,CAA1B;AACA,MAAMI,oBAAoB,gBAAGrD,KAAK,CAACmB,IAAN,CAAWgB,cAAX,EAA2Bc,aAA3B,CAA7B;;AAEA,MAAMK,YAAY,GAAG,CAAC;AAAElC,EAAAA,IAAF;AAAQmC,EAAAA,OAAR;AAAiBC,EAAAA,QAAjB;AAA2BC,EAAAA;AAA3B,CAAD,KAA2C;AAC5D,QAAM;AAAA,OAACC,KAAD;AAAA,OAAQC;AAAR,MAAoBlD,QAAQ,CAAC;AAAE4B,IAAAA,CAAC,EAAEjB,IAAI,CAACiB,CAAV;AAAaC,IAAAA,CAAC,EAAElB,IAAI,CAACkB,CAArB;AAAwBC,IAAAA,KAAK,EAAEnB,IAAI,CAACmB,KAApC;AAA2CC,IAAAA,MAAM,EAAEpB,IAAI,CAACoB;AAAxD,GAAD,CAAlC;AACA,QAAM;AAAA,OAACoB,QAAD;AAAA,OAAWC;AAAX,MAA0BpD,QAAQ,CAAC,KAAD,CAAxC;AACA,QAAM;AAAEqD,IAAAA,QAAF;AAAYC,IAAAA,GAAZ;AAAiBC,IAAAA,OAAjB;AAA0BC,IAAAA;AAA1B,MAAuClE,UAAU,CAAC;AACpDmE,IAAAA,WAAW,EAAE,IADuC;AAEpDC,IAAAA,UAAU,EAAE,CAFwC;AAGpDC,IAAAA,WAAW,EAAE,CAHuC;AAIpDJ,IAAAA,OAAO,EAAE,MAAM;AACXH,MAAAA,WAAW,CAAC,KAAD,CAAX;AACH,KANmD;AAOpDI,IAAAA,QAAQ,EAAE,MAAM;AACZJ,MAAAA,WAAW,CAAC,IAAD,CAAX;AACH;AATmD,GAAD,CAAvD;AAWA,QAAM,CAACQ,IAAD,IAAS7D,OAAO,CAACQ,QAAD,CAAtB;;AACA,QAAMsD,GAAG,GAAG,MAAM;AACdf,IAAAA,OAAO,CAACC,QAAD,CAAP;AACH,GAFD;;AAGA,QAAMe,KAAK,GAAG,MAAM;AAChBhB,IAAAA,OAAO,CAAC,EAAD,CAAP;AACH,GAFD;;AAIA,MAAInC,IAAI,CAACU,KAAL,KAAe,KAAnB,EAA0B;AACtB,wBACI,QAAC,SAAD;AACI,MAAA,cAAc,EAAE,CAACuC,IADrB;AAEI,MAAA,eAAe,EAAEA,IAFrB;AAGI,MAAA,WAAW,EAAEC,GAHjB;AAII,MAAA,aAAa,EAAEA,GAJnB;AAKI,MAAA,MAAM,EAAE,QALZ;AAMI,MAAA,QAAQ,EAAEb,QANd;AAOI,MAAA,IAAI,EAAE;AAAElB,QAAAA,KAAK,EAAEmB,KAAK,CAACnB,KAAf;AAAsBC,QAAAA,MAAM,EAAEkB,KAAK,CAAClB,MAApC;AAA4CgC,QAAAA,UAAU,EAAE;AAAxD,OAPV;AAQI,MAAA,QAAQ,EAAE;AAAEnC,QAAAA,CAAC,EAAEqB,KAAK,CAACrB,CAAX;AAAcC,QAAAA,CAAC,EAAEoB,KAAK,CAACpB;AAAvB,OARd;AASI,MAAA,UAAU,EAAE,CAACmC,CAAD,EAAIC,CAAJ,KAAU;AAClBf,QAAAA,QAAQ,iCAAMD,KAAN;AAAarB,UAAAA,CAAC,EAAEqC,CAAC,CAACrC,CAAlB;AAAqBC,UAAAA,CAAC,EAAEoC,CAAC,CAACpC;AAA1B,WAAR;AACH,OAXL;AAYI,MAAA,KAAK,EAAElB,IAAI,CAACuD,KAZhB;AAaI,MAAA,YAAY,EAAE,CAACF,CAAD,EAAIG,SAAJ,EAAeb,GAAf,EAAoBc,KAApB,EAA2BC,QAA3B,KAAwC;AAClDnB,QAAAA,QAAQ;AACJpB,UAAAA,KAAK,EAAEwB,GAAG,CAACY,KAAJ,CAAUpC,KADb;AAEJC,UAAAA,MAAM,EAAEuB,GAAG,CAACY,KAAJ,CAAUnC;AAFd,WAGDsC,QAHC,EAAR;AAKH,OAnBL;AAAA,8BAqBI,QAAC,MAAD;AAAQ,QAAA,GAAG,EAAE1D,IAAI,CAAC2D,GAAlB;AAAuB,QAAA,SAAS,EAAC;AAAjC;AAAA;AAAA;AAAA;AAAA,cArBJ,EAsBKtB,QAAQ,iBAAI,QAAC,KAAD;AAAO,QAAA,OAAO,EAAEc,KAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAtBjB;AAAA;AAAA;AAAA;AAAA;AAAA,YADJ;AA0BH;;AACD,MAAInD,IAAI,CAACU,KAAL,KAAe,OAAnB,EAA4B;AACxB,wBACI,QAAC,SAAD;AACI,MAAA,cAAc,EAAE,CAACuC,IADrB;AAEI,MAAA,eAAe,EAAEA,IAFrB;AAGI,MAAA,WAAW,EAAEC,GAHjB;AAII,MAAA,aAAa,EAAEA,GAJnB;AAKI,MAAA,MAAM,EAAE,QALZ;AAMI,MAAA,QAAQ,EAAEb,QANd;AAOI,MAAA,IAAI,EAAE;AAAElB,QAAAA,KAAK,EAAEmB,KAAK,CAACnB,KAAf;AAAsBC,QAAAA,MAAM,EAAEkB,KAAK,CAAClB,MAApC;AAA4CgC,QAAAA,UAAU,EAAE;AAAxD,OAPV;AAQI,MAAA,QAAQ,EAAE;AAAEnC,QAAAA,CAAC,EAAEqB,KAAK,CAACrB,CAAX;AAAcC,QAAAA,CAAC,EAAEoB,KAAK,CAACpB;AAAvB,OARd;AASI,MAAA,UAAU,EAAE,CAACmC,CAAD,EAAIC,CAAJ,KAAU;AAClBf,QAAAA,QAAQ,iCAAMD,KAAN;AAAarB,UAAAA,CAAC,EAAEqC,CAAC,CAACrC,CAAlB;AAAqBC,UAAAA,CAAC,EAAEoC,CAAC,CAACpC;AAA1B,WAAR;AACH,OAXL;AAYI,MAAA,KAAK,EAAElB,IAAI,CAACuD,KAZhB;AAaI,MAAA,YAAY,EAAE,CAACF,CAAD,EAAIG,SAAJ,EAAeb,GAAf,EAAoBc,KAApB,EAA2BC,QAA3B,KAAwC;AAClDnB,QAAAA,QAAQ;AACJpB,UAAAA,KAAK,EAAEwB,GAAG,CAACY,KAAJ,CAAUpC,KADb;AAEJC,UAAAA,MAAM,EAAEuB,GAAG,CAACY,KAAJ,CAAUnC;AAFd,WAGDsC,QAHC,EAAR;AAKH,OAnBL;AAAA,8BAqBI,QAAC,QAAD;AAAU,QAAA,GAAG,EAAE1D,IAAI,CAAC2D,GAApB;AAAyB,QAAA,SAAS,EAAE3D,IAAI,CAAC4D;AAAzC;AAAA;AAAA;AAAA;AAAA,cArBJ,EAsBKvB,QAAQ,iBAAI,QAAC,KAAD;AAAO,QAAA,OAAO,EAAEc,KAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAtBjB;AAAA;AAAA;AAAA;AAAA;AAAA,YADJ;AA0BH;;AACD,MAAInD,IAAI,CAACU,KAAL,KAAe,GAAnB,EAAwB;AACpB,wBACI,QAAC,SAAD;AACI,MAAA,cAAc,EAAE,CAACuC,IADrB;AAEI,MAAA,eAAe,EAAEA,IAFrB;AAGI,MAAA,WAAW,EAAEC,GAHjB;AAII,MAAA,aAAa,EAAEA,GAJnB;AAKI,MAAA,MAAM,EAAE,QALZ;AAMI,MAAA,QAAQ,EAAEb,QANd;AAOI,MAAA,IAAI,EAAE;AAAElB,QAAAA,KAAK,EAAEmB,KAAK,CAACnB,KAAf;AAAsBC,QAAAA,MAAM,EAAEkB,KAAK,CAAClB,MAApC;AAA4CgC,QAAAA,UAAU,EAAE;AAAxD,OAPV;AAQI,MAAA,QAAQ,EAAE;AAAEnC,QAAAA,CAAC,EAAEqB,KAAK,CAACrB,CAAX;AAAcC,QAAAA,CAAC,EAAEoB,KAAK,CAACpB;AAAvB,OARd;AASI,MAAA,UAAU,EAAE,CAACmC,CAAD,EAAIC,CAAJ,KAAU;AAClBf,QAAAA,QAAQ,iCAAMD,KAAN;AAAarB,UAAAA,CAAC,EAAEqC,CAAC,CAACrC,CAAlB;AAAqBC,UAAAA,CAAC,EAAEoC,CAAC,CAACpC;AAA1B,WAAR;AACH,OAXL;AAYI,MAAA,KAAK,EAAElB,IAAI,CAACuD,KAZhB;AAaI,MAAA,YAAY,EAAE,CAACF,CAAD,EAAIG,SAAJ,EAAeb,GAAf,EAAoBc,KAApB,EAA2BC,QAA3B,KAAwC;AAClDnB,QAAAA,QAAQ;AACJpB,UAAAA,KAAK,EAAEwB,GAAG,CAACY,KAAJ,CAAUpC,KADb;AAEJC,UAAAA,MAAM,EAAEuB,GAAG,CAACY,KAAJ,CAAUnC;AAFd,WAGDsC,QAHC,EAAR;AAKH,OAnBL;AAAA,8BAqBI,QAAC,IAAD;AAAM,QAAA,GAAG,EAAEf,GAAX;AAAgB,QAAA,KAAK,EAAE;AAAED,UAAAA;AAAF,SAAvB;AAAqC,QAAA,UAAU,EAAE1C,IAAI,CAACuD,KAAL,CAAWM,UAA5D;AAAwE,QAAA,IAAI,EAAE7D,IAAI,CAACuD,KAAL,CAAW,aAAX,CAA9E;AAAyG,QAAA,MAAM,EAAEvD,IAAI,CAACuD,KAAL,CAAW,aAAX,CAAjH;AAA4I,QAAA,QAAQ,EAAEf,QAAtJ;AAAA,kBACKxC,IAAI,CAAC8D;AADV;AAAA;AAAA;AAAA;AAAA,cArBJ,EAwBKzB,QAAQ,iBAAI,QAAC,KAAD;AAAO,QAAA,OAAO,EAAEc,KAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAxBjB;AAAA;AAAA;AAAA;AAAA;AAAA,YADJ;AA4BH;AACJ,CA5GD;;AA6GA,MAAMY,KAAK,GAAG9E,MAAM,CAAC+E,MAAV;AAAA;AAAA;AAAA,mGAAX;;AASA,SAASC,OAAT,CAAiB;AAAEjE,EAAAA,IAAF;AAAQE,EAAAA,KAAR;AAAeC,EAAAA,UAAf;AAA2B+D,EAAAA,SAA3B;AAAsC9D,EAAAA,MAAtC;AAA8CY,EAAAA;AAA9C,CAAjB,EAA2E;AACvE,QAAMmD,WAAW,GAAG7D,CAAC,CAAC8D,OAAF,CAAUpE,IAAI,CAACqE,iBAAf,EAAkC,WAAlC,CAApB;;AACA,QAAM,CAACC,QAAD,IAAalF,OAAO,CAACO,YAAD,CAA1B;AACA,QAAM,CAAC4E,SAAD,IAAcnF,OAAO,CAACS,aAAD,CAA3B;AACA,QAAM;AAAA,OAACwC,QAAD;AAAA,OAAWmC;AAAX,MAA0BnF,QAAQ,CAAC,KAAD,CAAxC;AACAP,EAAAA,SAAS,CAAC,MAAM;AACZ0F,IAAAA,WAAW,CAACF,QAAQ,CAACG,KAAT,KAAmBvE,KAApB,CAAX;AACH,GAFQ,EAEN,CAACoE,QAAQ,CAACG,KAAV,CAFM,CAAT;AAGA,QAAM;AAAA,OAACnC;AAAD,MAAUjD,QAAQ,CAAC;AAAE8E,IAAAA,WAAF;AAAeO,IAAAA,MAAM,EAAE1E,IAAI,CAAC0E;AAA5B,GAAD,CAAxB;AACA,QAAM;AAAA,OAACC,SAAD;AAAA,OAAYC;AAAZ,MAA4BvF,QAAQ,CAAC,EAAD,CAA1C;AACA,QAAMY,YAAY,GAAGpB,WAAW,CAAEmB,IAAD,IAAU;AACvC,UAAM6E,MAAM,GAAGpG,OAAO,CAACkC,QAAR,EAAf;AACAiE,IAAAA,YAAY,CAAEE,SAAD,IAAe;AACxBC,MAAAA,SAAS,CAACF,MAAD,CAAT;AACA,6CAAYC,SAAZ;AAAuB,SAACD,MAAD,qBAAe7E,IAAf;AAAvB;AACH,KAHW,CAAZ;AAIH,GAN+B,CAAhC;;AAQA,QAAMgF,QAAQ,GAAG1E,CAAC,CAAC2E,IAAF,CAAOjF,IAAI,CAACqE,iBAAZ,EAAgCa,CAAD,IAAOA,CAAC,CAACxE,KAAF,KAAY,OAAlD,CAAjB;;AACA,QAAM;AAAA,OAACyE,MAAD;AAAA,OAASJ;AAAT,MAAsB1F,QAAQ,EAApC;;AACA,QAAM8C,OAAO,GAAIiD,GAAD,IAAS;AACrBL,IAAAA,SAAS,CAACK,GAAD,CAAT;AACH,GAFD;;AAGA,QAAMC,UAAU,GAAGrE,QAAQ,CAACG,KAAT,GAAiBH,QAAQ,CAACI,MAA7C;;AACA,MAAIpB,IAAI,CAAC0E,MAAL,KAAgB,CAApB,EAAuB;AACnB,wBACI,QAAC,SAAD;AAAW,MAAA,QAAQ,EAAErC,QAArB;AAA+B,MAAA,EAAE,EAAG,GAAElC,UAAW,GAAEH,IAAI,CAACsF,QAAS,EAAjE;AAAA,8BACI,QAAC,KAAD;AAAA,mBACKpB,SAAS,CAACqB,KAAV,iBAAmB,QAAC,KAAD;AAAO,UAAA,GAAG,EAAErB,SAAS,CAAC/D,UAAV,GAAuB+D,SAAS,CAACqB,KAA7C;AAAoD,UAAA,MAAM,EAAErB,SAAS,CAACsB,SAAtE;AAAiF,UAAA,QAAQ,EAAEjB;AAA3F;AAAA;AAAA;AAAA;AAAA,gBADxB,eAOI,QAAC,mBAAD;AAAA,iCACI,QAAC,gBAAD;AAAkB,YAAA,KAAK,EAAEc,UAAzB;AAAA,sBACK/E,CAAC,CAACmF,KAAF,CAAQnD,KAAK,CAAC6B,WAAd,EACIuB,MADJ,GAEIC,OAFJ,GAGIC,KAHJ,GAIIpF,GAJJ,CAIQ,CAACC,GAAD,EAAMP,KAAN,KAAgB;AACjB,kCAAO,QAAC,oBAAD;AAAsB,gBAAA,IAAI,EAAEO,GAA5B;AAA6C,gBAAA,QAAQ,EAAEO,QAAvD;AAAiE,gBAAA,YAAY,EAAEf,YAA/E;AAA6F,gBAAA,KAAK,EAAEC,KAApG;AAA2G,gBAAA,UAAU,EAAEC,UAAvH;AAAmI,gBAAA,MAAM,EAAEC;AAA3I,iBAAsCF,KAAtC;AAAA;AAAA;AAAA;AAAA,sBAAP;AACH,aANJ;AADL;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,gBAPJ,eAkBI,QAAC,KAAD;AAAO,UAAA,GAAG,EAAEgE,SAAS,CAAC/D,UAAV,GAAuB+D,SAAS,CAAC2B,QAA7C;AAAuD,UAAA,MAAM,EAAE3B,SAAS,CAAC4B,YAAzE;AAAuF,UAAA,QAAQ,EAAEvB;AAAjG;AAAA;AAAA;AAAA;AAAA,gBAlBJ;AAAA;AAAA;AAAA;AAAA;AAAA,cADJ,EAqBKwB,MAAM,CAACC,OAAP,CAAerB,SAAf,EAA0BnE,GAA1B,CAA+BoF,KAAD,iBAC3B,QAAC,YAAD;AAAc,QAAA,IAAI,EAAEA,KAAK,CAAC,CAAD,CAAzB;AAA6C,QAAA,OAAO,EAAEzD,OAAtD;AAA+D,QAAA,QAAQ,EAAEgD,MAAM,KAAKS,KAAK,CAAC,CAAD,CAAzF;AAA8F,QAAA,QAAQ,EAAEA,KAAK,CAAC,CAAD;AAA7G,SAAmCA,KAAK,CAAC,CAAD,CAAxC;AAAA;AAAA;AAAA;AAAA,cADH,CArBL;AAAA;AAAA;AAAA;AAAA;AAAA,YADJ;AA2BH;;AACD,sBACI,QAAC,SAAD;AAAW,IAAA,QAAQ,EAAEvD,QAArB;AAA+B,IAAA,EAAE,EAAG,GAAElC,UAAW,GAAEH,IAAI,CAACsF,QAAS,EAAjE;AAAA,4BACI,QAAC,KAAD;AAAA,iBACKpB,SAAS,CAAC+B,KAAV,iBAAmB,QAAC,KAAD;AAAO,QAAA,GAAG,EAAE/B,SAAS,CAAC/D,UAAV,GAAuB+D,SAAS,CAACqB,KAA7C;AAAoD,QAAA,MAAM,EAAErB,SAAS,CAACsB,SAAtE;AAAiF,QAAA,QAAQ,EAAEjB;AAA3F;AAAA;AAAA;AAAA;AAAA,cADxB,EAEKS,QAAQ,iBACL,QAAC,cAAD;AAAA,+BACI,QAAC,QAAD;AAAU,UAAA,GAAG,EAAG,GAAE7E,UAAW,GAAE6E,QAAQ,CAACpE,IAAK;AAA7C;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,cAHR,eAOI,QAAC,eAAD;AAAA,kBACKN,CAAC,CAAC4F,KAAF,CAAQ5D,KAAK,CAACoC,MAAd,EAAuByB,CAAD,IAAO;AAC1B,8BAAO,QAAC,iBAAD;AAAmB,YAAA,IAAI,EAAE7D,KAAK,CAAC6B,WAAN,CAAkBgC,CAAC,GAAG,CAAtB,CAAzB;AAA2D,YAAA,YAAY,EAAElG,YAAzE;AAAuF,YAAA,KAAK,EAAEC,KAA9F;AAAqG,YAAA,UAAU,EAAEC,UAAjH;AAA6H,YAAA,MAAM,EAAEC;AAArI,aAAwD+F,CAAxD;AAAA;AAAA;AAAA;AAAA,kBAAP;AACH,SAFA;AADL;AAAA;AAAA;AAAA;AAAA,cAPJ,EAYKjC,SAAS,CAAC2B,QAAV,iBAAsB,QAAC,KAAD;AAAO,QAAA,GAAG,EAAE3B,SAAS,CAAC/D,UAAV,GAAuB+D,SAAS,CAAC2B,QAA7C;AAAuD,QAAA,MAAM,EAAE3B,SAAS,CAAC4B,YAAzE;AAAuF,QAAA,QAAQ,EAAEvB;AAAjG;AAAA;AAAA;AAAA;AAAA,cAZ3B;AAAA;AAAA;AAAA;AAAA;AAAA,YADJ,EAeKwB,MAAM,CAACC,OAAP,CAAerB,SAAf,EAA0BnE,GAA1B,CAA+BoF,KAAD,iBAC3B,QAAC,YAAD;AAAc,MAAA,IAAI,EAAEA,KAAK,CAAC,CAAD,CAAzB;AAA6C,MAAA,OAAO,EAAEzD,OAAtD;AAA+D,MAAA,QAAQ,EAAEgD,MAAM,KAAKS,KAAK,CAAC,CAAD,CAAzF;AAA8F,MAAA,QAAQ,EAAEA,KAAK,CAAC,CAAD;AAA7G,OAAmCA,KAAK,CAAC,CAAD,CAAxC;AAAA;AAAA;AAAA;AAAA,YADH,CAfL;AAAA;AAAA;AAAA;AAAA;AAAA,UADJ;AAqBH;;AACD,MAAMQ,KAAK,GAAGnH,MAAM,CAACoH,GAAV;AAAA;AAAA;AAAA,uDACQzE,KAAD,IAAWA,KAAK,CAACR,MADxB,EAGKQ,KAAD,IAAYA,KAAK,CAACS,QAAN,GAAiB,OAAjB,GAA2B,MAH3C,CAAX;AAMA,MAAMiE,KAAK,GAAGrH,MAAM,CAAC0C,GAAV;AAAA;AAAA;AAAA,sFAAX;AAQA,MAAM4E,gBAAgB,GAAGtH,MAAM,CAAC0C,GAAV;AAAA;AAAA;AAAA,kIAEqBC,KAAD,IAAWA,KAAK,CAAC4E,KAFrC,CAAtB;AAQA,MAAMC,mBAAmB,GAAGxH,MAAM,CAAC0C,GAAV;AAAA;AAAA;AAAA,4BAAzB;AAIA,MAAM+E,eAAe,GAAGzH,MAAM,CAAC0C,GAAV;AAAA;AAAA;AAAA,4BAArB;AAIA,MAAMgF,QAAQ,GAAG1H,MAAM,CAACoH,GAAV;AAAA;AAAA;AAAA,2EAAd;AAMA,MAAMO,cAAc,GAAG3H,MAAM,CAAC0C,GAAV;AAAA;AAAA;AAAA,gHAApB;AAQA,MAAMkF,IAAI,GAAG5H,MAAM,CAAC0C,GAAV;AAAA;AAAA;AAAA,6KAGUC,KAAD,IAAY,GAAEA,KAAK,CAACiC,UAAW,GAHxC,EAIUjC,KAAD,IAAWA,KAAK,CAACkF,MAJ1B,EAOUlF,KAAD,IAAWA,KAAK,CAACmF,IAP1B,EAQSnF,KAAD,IAAYA,KAAK,CAACY,QAAN,GAAiB,SAAjB,GAA6B,QARjD,CAAV;AAYA,MAAMwE,SAAS,GAAG/H,MAAM,CAACE,GAAD,CAAT;AAAA;AAAA;AAAA,oCAERyC,KAAD,IACEA,KAAK,CAACS,QAAN,IACAnD,GADA,8EAHO,CAAf;AAUA,MAAM+H,MAAM,GAAGhI,MAAM,CAACoH,GAAV;AAAA;AAAA;AAAA,qCAAZ;AAIA,MAAMa,WAAW,GAAGjI,MAAM,CAAC0C,GAAV;AAAA;AAAA;AAAA,+DAAjB;AAOA,MAAMwF,SAAS,GAAGlI,MAAM,CAAC0C,GAAV;AAAA;AAAA;AAAA,8IAECC,KAAD,IAAYA,KAAK,CAACS,QAAN,GAAiB,MAAjB,GAA0B,MAFtC,EAGUT,KAAD,IAAYA,KAAK,CAACwF,EAAN,GAAY,OAAMxF,KAAK,CAACwF,EAAG,GAA3B,GAAgC,MAHrD,CAAf;AAUA,4BAAexI,KAAK,CAACmB,IAAN,CAAWkE,OAAX,CAAf","sourcesContent":["import shortid from \"shortid\";\nimport toStyle from \"css-to-style\";\nimport useFitText from \"use-fit-text\";\nimport React, { useCallback, useEffect, useReducer, useRef } from \"react\";\nimport styled, { css } from \"styled-components\";\nimport { Rnd } from \"react-rnd\";\nimport { useAtom } from \"jotai\";\nimport { useState } from \"react\";\n\nimport InnerVideo from \"./InnerVideo\";\nimport RndVideo from \"./RndVideo\";\nimport Text from \"./Text\";\nimport Image, { FixedImage } from \"./Image\";\nimport { activityAtom, lockAtom, withFrameAtom } from \"../atom\";\n\nconst ChunkedData = React.memo(({ data, addFixedData, index, sourcePath, isFull }) => {\n    const sortedData = _.orderBy(data, \"order\");\n    return (\n        <InnerColumn>\n            {sortedData.map((obj) => {\n                if (obj.label === \"text_box\") {\n                    return <Text obj={obj} addFixedData={addFixedData} key={shortid.generate()} isFull={isFull} />;\n                } else if (obj.label === \"video\") {\n                    return (\n                        <InnerVideo\n                            url={`${sourcePath}${obj.path}`}\n                            addFixedData={addFixedData}\n                            startTime={obj.start_time}\n                            endTime={obj.end_time}\n                            index={index}\n                            key={shortid.generate()}\n                            index={index}\n                        />\n                    );\n                } else {\n                    return <Image url={`${sourcePath}${obj.path}`} addFixedData={addFixedData} key={shortid.generate()} />;\n                }\n            })}\n        </InnerColumn>\n    );\n});\nconst PositionedData = React.memo(({ data, addFixedData, index, sourcePath, isFull, template }) => {\n    const [x, y, width, height] = data.box_info_original;\n    const startXRatio = (x / template.width) * 100;\n    const startYRatio = (y / template.height) * 100;\n    const widthRatio = (width / template.width) * 100;\n    const heightRatio = (height / template.height) * 100;\n    if (data.label === \"text_box\") {\n        return (\n            <PositionedDataContainer x={startXRatio} y={startYRatio} width={widthRatio} height={heightRatio}>\n                <Text obj={data} addFixedData={addFixedData} key={shortid.generate()} isFull={isFull} />\n            </PositionedDataContainer>\n        );\n    }\n    if (data.label === \"video\") {\n        return (\n            <PositionedDataContainer x={startXRatio} y={startYRatio} width={widthRatio} height={heightRatio}>\n                <InnerVideo url={`${sourcePath}${obj.path}`} addFixedData={addFixedData} startTime={obj.start_time} endTime={obj.end_time} index={index} key={shortid.generate()} index={index} />\n            </PositionedDataContainer>\n        );\n    }\n    if (data.label === \"title\") {\n        return (\n            <PositionedDataContainer x={startXRatio} y={startYRatio} width={widthRatio} height={heightRatio}>\n                <FixedImage url={`${sourcePath}${data.path}`} key={shortid.generate()} />\n            </PositionedDataContainer>\n        );\n    }\n\n    return (\n        <PositionedDataContainer x={startXRatio} y={startYRatio} width={widthRatio} height={heightRatio}>\n            <Image url={`${sourcePath}${data.path}`} addFixedData={addFixedData} key={shortid.generate()} />\n        </PositionedDataContainer>\n    );\n});\nconst PositionedDataContainer = styled.div`\n    width: ${(props) => props.width}%;\n    height: ${(props) => props.height}%;\n    top: ${(props) => props.y}%;\n    left: ${(props) => props.x}%;\n    position: absolute;\n    display: flex;\n`;\n\nconst checkOnlyData = (prev, next) => {\n    return prev.data === next.data && prev.isFull === next.isFull;\n};\n\nconst MemoedChunkedData = React.memo(ChunkedData, checkOnlyData);\nconst MemoedPositionedData = React.memo(PositionedData, checkOnlyData);\n\nconst FixedElement = ({ data, clicked, keyValue, isactive }) => {\n    const [state, setState] = useState({ x: data.x, y: data.y, width: data.width, height: data.height });\n    const [visiable, setVisiable] = useState(false);\n    const { fontSize, ref, onStart, onFinish } = useFitText({\n        maxFontSize: 1000,\n        resolution: 1,\n        minFontSize: 1,\n        onStart: () => {\n            setVisiable(false);\n        },\n        onFinish: () => {\n            setVisiable(true);\n        },\n    });\n    const [lock] = useAtom(lockAtom);\n    const run = () => {\n        clicked(keyValue);\n    };\n    const clear = () => {\n        clicked(\"\");\n    };\n\n    if (data.label === \"IMG\") {\n        return (\n            <CustomRnd\n                enableResizing={!lock}\n                disableDragging={lock}\n                onDragStart={run}\n                onResizeStart={run}\n                bounds={\".frame\"}\n                isactive={isactive}\n                size={{ width: state.width, height: state.height, background: \"red\" }}\n                position={{ x: state.x, y: state.y }}\n                onDragStop={(e, d) => {\n                    setState({ ...state, x: d.x, y: d.y });\n                }}\n                style={data.style}\n                onResizeStop={(e, direction, ref, delta, position) => {\n                    setState({\n                        width: ref.style.width,\n                        height: ref.style.height,\n                        ...position,\n                    });\n                }}\n            >\n                <RndImg src={data.src} draggable=\"false\" />\n                {isactive && <Clear onClick={clear}>confirm</Clear>}\n            </CustomRnd>\n        );\n    }\n    if (data.label === \"VIDEO\") {\n        return (\n            <CustomRnd\n                enableResizing={!lock}\n                disableDragging={lock}\n                onDragStart={run}\n                onResizeStart={run}\n                bounds={\".frame\"}\n                isactive={isactive}\n                size={{ width: state.width, height: state.height, background: \"red\" }}\n                position={{ x: state.x, y: state.y }}\n                onDragStop={(e, d) => {\n                    setState({ ...state, x: d.x, y: d.y });\n                }}\n                style={data.style}\n                onResizeStop={(e, direction, ref, delta, position) => {\n                    setState({\n                        width: ref.style.width,\n                        height: ref.style.height,\n                        ...position,\n                    });\n                }}\n            >\n                <RndVideo url={data.src} startTime={data.startTime} />\n                {isactive && <Clear onClick={clear}>confirm</Clear>}\n            </CustomRnd>\n        );\n    }\n    if (data.label === \"P\") {\n        return (\n            <CustomRnd\n                enableResizing={!lock}\n                disableDragging={lock}\n                onDragStart={run}\n                onResizeStart={run}\n                bounds={\".frame\"}\n                isactive={isactive}\n                size={{ width: state.width, height: state.height, background: \"red\" }}\n                position={{ x: state.x, y: state.y }}\n                onDragStop={(e, d) => {\n                    setState({ ...state, x: d.x, y: d.y });\n                }}\n                style={data.style}\n                onResizeStop={(e, direction, ref, delta, position) => {\n                    setState({\n                        width: ref.style.width,\n                        height: ref.style.height,\n                        ...position,\n                    });\n                }}\n            >\n                <PCon ref={ref} style={{ fontSize }} lineHeight={data.style.lineHeight} font={data.style[\"font-family\"]} weight={data.style[\"font-weight\"]} visiable={visiable}>\n                    {data.text}\n                </PCon>\n                {isactive && <Clear onClick={clear}>confirm</Clear>}\n            </CustomRnd>\n        );\n    }\n};\nconst Clear = styled.button`\n    position: absolute;\n    right: 0;\n    top: -20px;\n    @media only screen and (max-width: 900px) {\n        display: none;\n    }\n`;\n\nfunction Content({ data, index, sourcePath, frameInfo, isFull, template }) {\n    const chunkedData = _.groupBy(data.learning_material, \"in_column\");\n    const [activity] = useAtom(activityAtom);\n    const [withFrame] = useAtom(withFrameAtom);\n    const [isactive, setIsActive] = useState(false);\n    useEffect(() => {\n        setIsActive(activity.slide === index);\n    }, [activity.slide]);\n    const [state] = useState({ chunkedData, column: data.column });\n    const [fixedData, setFixedData] = useState({});\n    const addFixedData = useCallback((data) => {\n        const newKey = shortid.generate();\n        setFixedData((prevState) => {\n            setNodeEl(newKey);\n            return { ...prevState, [newKey]: { ...data } };\n        });\n    });\n\n    const titleObj = _.find(data.learning_material, (o) => o.label === \"title\");\n    const [nodeEl, setNodeEl] = useState();\n    const clicked = (key) => {\n        setNodeEl(key);\n    };\n    const frameRatio = template.width / template.height;\n    if (data.column === 0) {\n        return (\n            <Container isactive={isactive} bg={`${sourcePath}${data.bg_image}`}>\n                <Inner>\n                    {frameInfo.topBg && <Frame src={frameInfo.sourcePath + frameInfo.topBg} height={frameInfo.topHeight} isactive={withFrame} />}\n                    {/* {titleObj && (\n                        <TitleContainer>\n                            <TitleImg src={`${sourcePath}${titleObj.path}`} />\n                        </TitleContainer>\n                    )} */}\n                    <PositionedContainer>\n                        <PositionedCanvas ratio={frameRatio}>\n                            {_.chain(state.chunkedData)\n                                .values()\n                                .flatten()\n                                .value()\n                                .map((obj, index) => {\n                                    return <MemoedPositionedData data={obj} key={index} template={template} addFixedData={addFixedData} index={index} sourcePath={sourcePath} isFull={isFull} />;\n                                })}\n                        </PositionedCanvas>\n                    </PositionedContainer>\n                    <Frame src={frameInfo.sourcePath + frameInfo.bottomBg} height={frameInfo.bottomHeight} isactive={withFrame} />\n                </Inner>\n                {Object.entries(fixedData).map((value) => (\n                    <FixedElement data={value[1]} key={value[0]} clicked={clicked} isactive={nodeEl === value[0]} keyValue={value[0]} />\n                ))}\n            </Container>\n        );\n    }\n    return (\n        <Container isactive={isactive} bg={`${sourcePath}${data.bg_image}`}>\n            <Inner>\n                {frameInfo.topBG && <Frame src={frameInfo.sourcePath + frameInfo.topBg} height={frameInfo.topHeight} isactive={withFrame} />}\n                {titleObj && (\n                    <TitleContainer>\n                        <TitleImg src={`${sourcePath}${titleObj.path}`} />\n                    </TitleContainer>\n                )}\n                <ColumnContainer>\n                    {_.times(state.column, (i) => {\n                        return <MemoedChunkedData data={state.chunkedData[i + 1]} key={i} addFixedData={addFixedData} index={index} sourcePath={sourcePath} isFull={isFull} />;\n                    })}\n                </ColumnContainer>\n                {frameInfo.bottomBg && <Frame src={frameInfo.sourcePath + frameInfo.bottomBg} height={frameInfo.bottomHeight} isactive={withFrame} />}\n            </Inner>\n            {Object.entries(fixedData).map((value) => (\n                <FixedElement data={value[1]} key={value[0]} clicked={clicked} isactive={nodeEl === value[0]} keyValue={value[0]} />\n            ))}\n        </Container>\n    );\n}\nconst Frame = styled.img`\n    flex-basis: ${(props) => props.height}%;\n    object-fit: fill;\n    display: ${(props) => (props.isactive ? \"block\" : \"none\")};\n`;\n\nconst Inner = styled.div`\n    display: flex;\n    flex-direction: column;\n    flex: 1;\n    align-items: stretch;\n    max-height: 85vh;\n`;\n\nconst PositionedCanvas = styled.div`\n    --current-height: calc(100vh - 50px);\n    width: calc(var(--current-height) * ${(props) => props.ratio});\n    height: 100%;\n    margin: 0 auto;\n    position: relative;\n`;\n\nconst PositionedContainer = styled.div`\n    display: flex;\n    flex: 1;\n`;\nconst ColumnContainer = styled.div`\n    flex: 1;\n    display: flex;\n`;\nconst TitleImg = styled.img`\n    width: 100%;\n    height: 100%;\n    object-fit: contain;\n    object-position: left top;\n`;\nconst TitleContainer = styled.div`\n    height: 10%;\n    width: 100%;\n    padding: 0 20px 0 !important;\n    @media only screen and (max-width: 900px) {\n        height: 20px;\n    }\n`;\nconst PCon = styled.div`\n    width: 100%;\n    height: 100%;\n    line-height: ${(props) => `${props.lineHeight}%`};\n    font-weight: ${(props) => props.weight};\n    letter-spacing: 0;\n    white-space: pre-wrap;\n    font-family: ${(props) => props.font};\n    visibility: ${(props) => (props.visiable ? \"visible\" : \"hidden\")};\n    box-sizing: border-box;\n    padding: 0.5px;\n`;\nconst CustomRnd = styled(Rnd)`\n    box-sizing: border-box;\n    ${(props) =>\n        props.isactive &&\n        css`\n            z-index: 10;\n            outline: 2px solid #a9ceeb;\n            box-shadow: 0px 2px 5px 5px #a9ceeb;\n        `};\n`;\nconst RndImg = styled.img`\n    width: inherit;\n    height: inherit;\n`;\nconst InnerColumn = styled.div`\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    padding: 10px;\n`;\n\nconst Container = styled.div`\n    padding-top: 16px;\n    display: ${(props) => (props.isactive ? \"flex\" : \"none\")};\n    background-image: ${(props) => (props.bg ? `url(${props.bg})` : \"none\")};\n    background-repeat: no-repeat;\n    background-size: 100% 100%;\n    flex: 1;\n    align-items: stretch;\n`;\n\nexport default React.memo(Content);\n"]},"metadata":{},"sourceType":"module"}