{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/jeongyeon/Desktop/lecture_segmentation/web_dev/code/t1_km/components/Video.jsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport _ from \"lodash\";\nimport styled, { css } from \"styled-components\";\nimport { Rnd } from \"react-rnd\";\nimport { forwardRef, useEffect, useImperativeHandle, useRef, useState } from \"react\";\nimport { useAtom } from \"jotai\";\nimport { activityAtom, currentAtom, currentTimeAtom, durationAtom, durationTimeAtom, lockAtom, percentAtom, playingAtom, withVideoAtom } from \"../atom\";\n\nfunction Video({\n  src,\n  content,\n  videoLocation\n}, ref) {\n  const {\n    0: positionState,\n    1: setPositionState\n  } = useState({\n    width: \"auto\",\n    height: \"auto\",\n    x: 100,\n    y: 100\n  });\n  const [withVideo] = useAtom(withVideoAtom);\n  const [activity, setActivity] = useAtom(activityAtom);\n  const [currentTime, setCurrentTime] = useAtom(currentTimeAtom);\n  const [durationTime, setDurationTime] = useAtom(durationTimeAtom);\n  const [duration, setDuration] = useAtom(durationAtom);\n  const [percent, setPercent] = useAtom(percentAtom);\n  const [current, setCurrent] = useAtom(currentAtom);\n  const {\n    0: fixed,\n    1: setFixed\n  } = useState(false);\n  const {\n    0: viable,\n    1: setViable\n  } = useState(true);\n  const {\n    0: nodeVideoLocation,\n    1: setNodeVideoLocation\n  } = useState();\n  const [lock] = useAtom(lockAtom);\n\n  const setFixedTrue = () => {\n    setFixed(true);\n  };\n\n  const [play, setPlay] = useAtom(playingAtom);\n  const videoRef = useRef();\n  useEffect(() => {\n    if (!nodeVideoLocation) {\n      setViable(false);\n      return;\n    } else {\n      setViable(true);\n    }\n\n    if (fixed) {\n      return;\n    }\n\n    const [,, w, h] = nodeVideoLocation;\n    const targetWidth = window.innerWidth * 0.2;\n    const targetHeight = targetWidth / w * h;\n    setPositionState(prev => ({\n      width: `${targetWidth}px`,\n      height: `${targetHeight}px`,\n      x: window.innerWidth - targetWidth,\n      y: window.innerHeight - targetHeight - 70\n    }));\n  }, [nodeVideoLocation, fixed]);\n  useImperativeHandle(ref, () => ({\n    move: () => {\n      videoRef.current.play();\n      setTimeout(() => {\n        if (!play) {\n          videoRef.current.pause();\n          setPlay(false);\n        }\n      }, 100);\n    },\n    toggle: () => {\n      if (play) {\n        videoRef.current.pause();\n        setPlay(false);\n      } else {\n        videoRef.current.play();\n        setPlay(true);\n      }\n    },\n    jump: percentPoint => {\n      const time = percentPoint * duration;\n      setPercent(percentPoint);\n      videoRef.current.currentTime = time;\n      videoRef.current.play();\n      setTimeout(() => {\n        if (!play) {\n          videoRef.current.pause();\n          setPlay(false);\n        }\n      }, 100);\n\n      const slide = _.findLastIndex(content, obj => obj.start_time < time);\n\n      const action = \"jump\";\n      setActivity({\n        slide,\n        action,\n        time,\n        play\n      });\n    }\n  }), [videoRef.current, play, duration]);\n\n  const onTimeEvent = () => {\n    const video = videoRef.current;\n    const time = video.currentTime;\n\n    const slide = _.findLastIndex(content, obj => obj.start_time < time);\n\n    const vl = _.findLast(videoLocation, obj => obj.start_time < time);\n\n    if (vl && vl.box_info) {\n      setNodeVideoLocation(vl.box_info);\n    } else {\n      setNodeVideoLocation(false);\n    }\n\n    const action = activity.slide === slide ? \"playing\" : \"flip\";\n    setActivity({\n      slide,\n      action,\n      time\n    });\n    const percentPoint = time / video.duration;\n    const minutes = Math.floor(time / 60);\n    const seconds = Math.floor(time - 60 * minutes).toString().padStart(2, \"0\");\n    setCurrentTime(`${minutes}:${seconds}`);\n    setPercent(percentPoint * 100);\n  };\n\n  const loaded = e => {\n    const targetDue = e.currentTarget.duration;\n    setDuration(targetDue);\n    const {\n      videoWidth,\n      videoHeight\n    } = e.currentTarget;\n    const targetWidth = window.innerWidth * 0.2;\n    const targetHeight = targetWidth / videoWidth * videoHeight; // setPositionState((prev) => ({ width: `${targetWidth}px`, height: `${targetHeight}px`, x: window.innerWidth - targetWidth, y: window.innerHeight - targetHeight - 50 }));\n\n    const minutes = Math.floor(targetDue / 60);\n    const seconds = Math.floor(targetDue - 60 * minutes).toString().padStart(2, \"0\");\n    setDurationTime(`${minutes}:${seconds}`);\n  };\n\n  useEffect(() => {\n    if (videoRef.current) {\n      videoRef.current.currentTime = activity.time;\n      videoRef.current.pause();\n      setPlay(false);\n    }\n  }, [videoRef]);\n  return /*#__PURE__*/_jsxDEV(CustomRnd, {\n    visiable: viable,\n    size: {\n      width: positionState.width,\n      height: positionState.height,\n      background: \"red\"\n    },\n    position: {\n      x: positionState.x,\n      y: positionState.y\n    },\n    onDragStart: setFixedTrue,\n    onResizeStart: setFixedTrue,\n    bounds: \".frame\",\n    enableResizing: !lock,\n    disableDragging: lock,\n    onDragStop: (e, d) => {\n      setPositionState(_objectSpread(_objectSpread({}, positionState), {}, {\n        x: d.x,\n        y: d.y\n      }));\n    },\n    onResizeStop: (e, direction, ref, delta, position) => {\n      setPositionState(_objectSpread({\n        width: ref.style.width,\n        height: ref.style.height\n      }, position));\n    },\n    children: /*#__PURE__*/_jsxDEV(VideoEl, {\n      src: src,\n      onTimeUpdate: onTimeEvent,\n      ref: videoRef,\n      active: withVideo,\n      playsInline: true,\n      isDrag: true,\n      onLoadedMetadata: loaded\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 131,\n    columnNumber: 9\n  }, this);\n}\n\nconst CustomRnd = styled(Rnd).withConfig({\n  displayName: \"Video__CustomRnd\",\n  componentId: \"sc-16yaw0k-0\"\n})([\"box-sizing:border-box;z-index:100;visibility:\", \";\"], props => props.visiable ? \"visiable\" : \"hidden\");\nconst VideoEl = styled.video.withConfig({\n  displayName: \"Video__VideoEl\",\n  componentId: \"sc-16yaw0k-1\"\n})([\"margin-left:auto;display:block;opacity:0;height:inherit;max-width:100%;\", \" \", \"\"], props => props.active && css([\"opacity:1;\"]), props => props.isDrag && css([\"height:100%;width:100%;object-fit:fill;\"]));\nexport default /*#__PURE__*/forwardRef(Video);","map":{"version":3,"sources":["/Users/jeongyeon/Desktop/lecture_segmentation/web_dev/code/t1_km/components/Video.jsx"],"names":["_","styled","css","Rnd","forwardRef","useEffect","useImperativeHandle","useRef","useState","useAtom","activityAtom","currentAtom","currentTimeAtom","durationAtom","durationTimeAtom","lockAtom","percentAtom","playingAtom","withVideoAtom","Video","src","content","videoLocation","ref","positionState","setPositionState","width","height","x","y","withVideo","activity","setActivity","currentTime","setCurrentTime","durationTime","setDurationTime","duration","setDuration","percent","setPercent","current","setCurrent","fixed","setFixed","viable","setViable","nodeVideoLocation","setNodeVideoLocation","lock","setFixedTrue","play","setPlay","videoRef","w","h","targetWidth","window","innerWidth","targetHeight","prev","innerHeight","move","setTimeout","pause","toggle","jump","percentPoint","time","slide","findLastIndex","obj","start_time","action","onTimeEvent","video","vl","findLast","box_info","minutes","Math","floor","seconds","toString","padStart","loaded","e","targetDue","currentTarget","videoWidth","videoHeight","background","d","direction","delta","position","style","CustomRnd","props","visiable","VideoEl","active","isDrag"],"mappings":"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","sourcesContent":["import _ from \"lodash\";\nimport styled, { css } from \"styled-components\";\nimport { Rnd } from \"react-rnd\";\nimport { forwardRef, useEffect, useImperativeHandle, useRef, useState } from \"react\";\nimport { useAtom } from \"jotai\";\n\nimport { activityAtom, currentAtom, currentTimeAtom, durationAtom, durationTimeAtom, lockAtom, percentAtom, playingAtom, withVideoAtom } from \"../atom\";\n\nfunction Video({ src, content, videoLocation }, ref) {\n    const [positionState, setPositionState] = useState({\n        width: \"auto\",\n        height: \"auto\",\n        x: 100,\n        y: 100,\n    });\n    const [withVideo] = useAtom(withVideoAtom);\n    const [activity, setActivity] = useAtom(activityAtom);\n    const [currentTime, setCurrentTime] = useAtom(currentTimeAtom);\n    const [durationTime, setDurationTime] = useAtom(durationTimeAtom);\n    const [duration, setDuration] = useAtom(durationAtom);\n    const [percent, setPercent] = useAtom(percentAtom);\n    const [current, setCurrent] = useAtom(currentAtom);\n    const [fixed, setFixed] = useState(false);\n    const [viable, setViable] = useState(true);\n    const [nodeVideoLocation, setNodeVideoLocation] = useState();\n    const [lock] = useAtom(lockAtom);\n    const setFixedTrue = () => {\n        setFixed(true);\n    };\n\n    const [play, setPlay] = useAtom(playingAtom);\n    const videoRef = useRef();\n    useEffect(() => {\n        if (!nodeVideoLocation) {\n            setViable(false);\n            return;\n        } else {\n            setViable(true);\n        }\n        if (fixed) {\n            return;\n        }\n        const [, , w, h] = nodeVideoLocation;\n        const targetWidth = window.innerWidth * 0.2;\n        const targetHeight = (targetWidth / w) * h;\n        setPositionState((prev) => ({ width: `${targetWidth}px`, height: `${targetHeight}px`, x: window.innerWidth - targetWidth, y: window.innerHeight - targetHeight - 70 }));\n    }, [nodeVideoLocation, fixed]);\n    useImperativeHandle(\n        ref,\n        () => ({\n            move: () => {\n                videoRef.current.play();\n                setTimeout(() => {\n                    if (!play) {\n                        videoRef.current.pause();\n                        setPlay(false);\n                    }\n                }, 100);\n            },\n            toggle: () => {\n                if (play) {\n                    videoRef.current.pause();\n                    setPlay(false);\n                } else {\n                    videoRef.current.play();\n                    setPlay(true);\n                }\n            },\n            jump: (percentPoint) => {\n                const time = percentPoint * duration;\n                setPercent(percentPoint);\n                videoRef.current.currentTime = time;\n                videoRef.current.play();\n                setTimeout(() => {\n                    if (!play) {\n                        videoRef.current.pause();\n                        setPlay(false);\n                    }\n                }, 100);\n                const slide = _.findLastIndex(content, (obj) => obj.start_time < time);\n                const action = \"jump\";\n                setActivity({ slide, action, time, play });\n            },\n        }),\n        [videoRef.current, play, duration]\n    );\n\n    const onTimeEvent = () => {\n        const video = videoRef.current;\n        const time = video.currentTime;\n        const slide = _.findLastIndex(content, (obj) => obj.start_time < time);\n        const vl = _.findLast(videoLocation, (obj) => obj.start_time < time);\n        if (vl && vl.box_info) {\n            setNodeVideoLocation(vl.box_info);\n        } else {\n            setNodeVideoLocation(false);\n        }\n        const action = activity.slide === slide ? \"playing\" : \"flip\";\n        setActivity({ slide, action, time });\n        const percentPoint = time / video.duration;\n        const minutes = Math.floor(time / 60);\n        const seconds = Math.floor(time - 60 * minutes)\n            .toString()\n            .padStart(2, \"0\");\n        setCurrentTime(`${minutes}:${seconds}`);\n        setPercent(percentPoint * 100);\n    };\n\n    const loaded = (e) => {\n        const targetDue = e.currentTarget.duration;\n        setDuration(targetDue);\n        const { videoWidth, videoHeight } = e.currentTarget;\n        const targetWidth = window.innerWidth * 0.2;\n        const targetHeight = (targetWidth / videoWidth) * videoHeight;\n        // setPositionState((prev) => ({ width: `${targetWidth}px`, height: `${targetHeight}px`, x: window.innerWidth - targetWidth, y: window.innerHeight - targetHeight - 50 }));\n        const minutes = Math.floor(targetDue / 60);\n        const seconds = Math.floor(targetDue - 60 * minutes)\n            .toString()\n            .padStart(2, \"0\");\n        setDurationTime(`${minutes}:${seconds}`);\n    };\n    useEffect(() => {\n        if (videoRef.current) {\n            videoRef.current.currentTime = activity.time;\n            videoRef.current.pause();\n            setPlay(false);\n        }\n    }, [videoRef]);\n\n    return (\n        <CustomRnd\n            visiable={viable}\n            size={{ width: positionState.width, height: positionState.height, background: \"red\" }}\n            position={{ x: positionState.x, y: positionState.y }}\n            onDragStart={setFixedTrue}\n            onResizeStart={setFixedTrue}\n            bounds={\".frame\"}\n            enableResizing={!lock}\n            disableDragging={lock}\n            onDragStop={(e, d) => {\n                setPositionState({ ...positionState, x: d.x, y: d.y });\n            }}\n            onResizeStop={(e, direction, ref, delta, position) => {\n                setPositionState({\n                    width: ref.style.width,\n                    height: ref.style.height,\n                    ...position,\n                });\n            }}\n        >\n            <VideoEl src={src} onTimeUpdate={onTimeEvent} ref={videoRef} active={withVideo} playsInline isDrag={true} onLoadedMetadata={loaded} />\n        </CustomRnd>\n    );\n}\n\nconst CustomRnd = styled(Rnd)`\n    box-sizing: border-box;\n    z-index: 100;\n    visibility: ${(props) => (props.visiable ? \"visiable\" : \"hidden\")};\n`;\n\nconst VideoEl = styled.video`\n    margin-left: auto;\n    display: block;\n    opacity: 0;\n    height: inherit;\n    max-width: 100%;\n    ${(props) =>\n        props.active &&\n        css`\n            opacity: 1;\n        `}\n\n    ${(props) =>\n        props.isDrag &&\n        css`\n            height: 100%;\n            width: 100%;\n            object-fit: fill;\n        `}\n`;\nexport default forwardRef(Video);\n"]},"metadata":{},"sourceType":"module"}